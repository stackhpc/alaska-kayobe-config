---
###############################################################################
# Ironic inspector PXE configuration.

# List of extra kernel parameters for the inspector default PXE configuration.
#inspector_extra_kernel_options:

# URL of Ironic Python Agent (IPA) kernel image.
#inspector_ipa_kernel_upstream_url:

# URL of checksum of Ironic Python Agent (IPA) kernel image.
#inspector_ipa_kernel_checksum_url:

# Algorithm of checksum of Ironic Python Agent (IPA) kernel image.
#inspector_ipa_kernel_checksum_algorithm:

# URL of Ironic Python Agent (IPA) ramdisk image.
#inspector_ipa_ramdisk_upstream_url:

# URL of checksum of Ironic Python Agent (IPA) ramdisk image.
#inspector_ipa_ramdisk_checksum_url:

# Algorithm of checksum of Ironic Python Agent (IPA) ramdisk image.
#inspector_ipa_ramdisk_checksum_algorithm:

###############################################################################
# Ironic inspector processing configuration.

# List of of default inspector processing plugins.
#inspector_processing_hooks_default:
# Remove scheduler from default processing hooks.
inspector_processing_hooks_default:
  - ramdisk_error
  - validate_interfaces
  - capabilities
  - pci_devices
  - local_link_connection
  - lldp_basic

# List of of additional inspector processing plugins.
#inspector_processing_hooks_extra:
inspector_processing_hooks_extra:
  # Adds switch system name to ironic port local_link_connection.
  - system_name_llc
  # Assigns physical_network to ironic port based on switch system name.
  - system_name_physnet
  # Assigns physical_network to ironic port for Infiniband ports.
  - ib_physnet
  # Processes additional inventory data collected by the extra-hardware
  # collector.
  - extra_hardware

# List of of additional inspector processing plugins.
#inspector_processing_hooks:

# Which MAC addresses to add as ports during introspection. One of 'all',
# 'active' or 'pxe'.
#inspector_add_ports:
inspector_add_ports: all

# Which ports to keep after introspection. One of 'all', 'present', or 'added'.
#inspector_keep_ports:

# Whether to enable discovery of nodes not managed by Ironic.
#inspector_enable_discovery:

# The Ironic driver with which to register newly discovered nodes.
#inspector_discovery_enroll_node_driver:

###############################################################################
# Ironic inspector configuration.

# Ironic inspector IPMI username to set.
#inspector_ipmi_username:

# Ironic inspector IPMI password to set.
#inspector_ipmi_password:

# Ironic inspector default network interface name on which to check for an LLDP
# switch port description to use as the node's name.
#inspector_lldp_switch_port_interface_default:
inspector_lldp_switch_port_interface_default: eno1

# Ironic inspector map from hostname to network interface name on which to
# check for an LLDP switch port description to use as the node's name.
#inspector_lldp_switch_port_interface_map:
inspector_lldp_switch_port_interface_map:
  gpu-b16-u1: enp6s0f0
  gpu-b16-u2: enp6s0f0

###############################################################################
# Ironic inspector introspection rules configuration.

# Ironic inspector rule to set IPMI credentials.
#inspector_rule_ipmi_credentials:

# Ironic inspector rule to set deployment kernel.
#inspector_rule_deploy_kernel:

# Ironic inspector rule to set deployment ramdisk.
#inspector_rule_deploy_ramdisk:

# Ironic inspector rule to set local boot capability
#inspector_rule_local_boot:

# Ironic inspector rule to initialise root device hints.
#inspector_rule_root_hint_init:

# Ironic inspector rule to set serial root device hint.
#inspector_rule_root_hint_serial:

# Ironic inspector rule to set the interface on which the node PXE booted.
#inspector_rule_set_pxe_interface_mac:

# Ironic inspector rule to set the node's name from an interface's LLDP switch
# port description.
#inspector_rule_lldp_switch_port_desc_to_name:

# Ironic inspector rule to save introspection data to the node.
#inspector_rule_save_data:

# List of default ironic insepctor rules.
#inspector_rules_default:

# List of additional ironic inspector rules.
#inspector_rules_extra:
inspector_rules_extra:
  - description: "Set the expected BIOS version for PowerEdge R630/R730/R730XD nodes."
    conditions:
    - field: "data://inventory.system_vendor.product_name"
      op: "matches"
      value: "^(PowerEdge R630|PowerEdge R730|PowerEdge R730xd)$"
    actions:
    - action: "set-attribute"
      path: "extra/system_vendor/bios_version"
      value: "2.6.0"
  - description: "Set the expected BIOS version for PowerEdge C1430."
    conditions:
    - field: "data://inventory.system_vendor.product_name"
      op: "matches"
      value: "^(PowerEdge C4130)$"
    actions:
    - action: "set-attribute"
      path: "extra/system_vendor/bios_version"
      value: "2.6.0"
  - description: "Set the expected firmware version for Mellanox ConnectX-4"
    conditions:
    - field: "data://inventory.interfaces[*].product"
      op: "matches"
      value: "^(0x1013)$"
    - field: "data://inventory.interfaces[*].vendor"
      op: "matches"
      value: "^(0x15B3)$"
    actions:
      - action: "extend-attribute"
      - path: "extra/nic_firmware"
      - value: '[{"vendor_id": "15B3", "device_id": "1013", "firmware_version": "12.20.1010"}]'

# List of all ironic inspector rules.
#inspector_rules:

###############################################################################
# Dell switch LLDP workaround configuration.

# Some Dell switch OSs (including Dell Network OS 9.10(0.1)) do not support
# sending interface port description TLVs correctly. Instead of sending the
# interface description, they send the interface name (e.g. TenGigabitEthernet
# 1/1/1). This breaks the discovery process which relies on Ironic node
# introspection data containing the node's name in the interface port
# description. We work around this here by creating an introspection rule for
# each ironic node that matches against the switch system and the relevant
# interface name, then sets the node's name appropriately.

# Ansible group containing switch hosts to which the workaround should be
# applied.
#inspector_dell_switch_lldp_workaround_group:
inspector_dell_switch_lldp_workaround_group: "ctl-switches"

###############################################################################
# Inspection store configuration.
# The inspection store provides a Swift-like service for storing inspection
# data which may be useful in environments without Swift.

# Whether the inspection data store is enabled.
#inspector_store_enabled:

# Port on which the inspection data store should listen.
#inspector_store_port:

###############################################################################
# Dummy variable to allow Ansible to accept this file.
workaround_ansible_issue_8743: yes
